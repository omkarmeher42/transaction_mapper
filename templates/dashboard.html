<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Transaction Mapper</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='notifications.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <!-- Mobile Hamburger Menu Toggle -->
    <button class="hamburger-menu" id="hamburger-toggle" aria-label="Toggle navigation menu">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Left Side: Tabs -->
    <div class="tabs" id="nav-tabs">
        <div class="tab" id="dashboard-tab" data-tab="dashboard">
          <a href="/dashboard">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div class="tab" id="map-transaction-tab" data-tab="map-transaction">
          <a href="/map_transaction">
            <i class="fas fa-map"></i>
            <span>Map Transaction</span>
          </a>
        </div>
        <div class="tab" id="quick-map-tab" data-tab="quick-map">
          <a href="/quick_map">
            <i class="fas fa-bolt"></i>
            <span>Quick Map</span>
          </a>
        </div>
        <div class="tab" id="view-transactions-tab" data-tab="view-transactions">
          <a href="/view_transactions">
            <i class="fas fa-list"></i>
            <span>View Transactions</span>
          </a>
        </div>
        <div class="tab" id="budgets-tab" data-tab="budgets">
          <a href="/budgets">
            <i class="fas fa-wallet"></i>
            <span>Budgets</span>
          </a>
        </div>
        <div class="tab" id="recurring-tab" data-tab="recurring">
          <a href="/recurring">
            <i class="fas fa-redo"></i>
            <span>Recurring</span>
          </a>
        </div>
        <div class="tab" id="download-tab" data-tab="download">
          <a href="/download">
            <i class="fas fa-download"></i>
            <span>Download</span>
          </a>
        </div>
        <div class="tab" id="spendings-tab" data-tab="spendings">
          <a href="{{ url_for('transaction.spendings') }}">
            <i class="fas fa-dollar-sign"></i>
            <span>Spendings</span>
          </a>
        </div>
      </div>

    <!-- Right Side: Theme Toggle and User Icon -->
    <div class="user-actions">
      <!-- Theme Toggle -->
      <div class="theme-toggle">
        <input type="checkbox" id="theme-switch">
        <label for="theme-switch" class="toggle-slider"></label>
      </div>

      <!-- User Icon -->
      <div class="user-icon" onclick="handleUserIconClick();">
        <i class="fas fa-user"></i>
      </div>

      <!-- Logout Link -->
      <a href="#" id="logoutLink" class="logout-link">Logout</a>
    </div>
  </nav>
  
  <!-- Flash Messages -->
  {% include 'notifications.html' %}

  <!-- Main Content -->
  <main>
    <div class="dashboard-content">
      <div class="welcome-message">
        <h1>Welcome back, {{ user.user_name }}!</h1>
        <p>Here's what your finances look like this month.</p>
      </div>

      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="card summary-card">
          <div class="card-icon"><i class="fas fa-wallet"></i></div>
          <div class="card-info">
            <h3>Total Spent</h3>
            <p>₹{{ summary.total_spent }}</p>
          </div>
        </div>
        <div class="card summary-card">
          <div class="card-icon"><i class="fas fa-chart-line"></i></div>
          <div class="card-info">
            <h3>Top Category</h3>
            <p>{{ summary.top_category }}</p>
          </div>
        </div>
      </div>

      <div class="dashboard-grid">
        <!-- Visualization -->
        <div class="card chart-container">
          <h3>Spending by Category</h3>
          <canvas id="spendingChart"></canvas>
        </div>

        <!-- Recent Transactions -->
        <div class="card recent-transactions">
          <h3>Recent Transactions</h3>
          <div class="table-scroll">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Title</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody>
                {% for tx in summary.recent_transactions %}
                <tr>
                  <td>{{ tx.date }}</td>
                  <td>{{ tx.title }}</td>
                  <td>₹{{ tx.amount }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <a href="/view_transactions" class="view-all-link">View All Transactions</a>
        </div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='main.js') }}"></script>
  <script>
    // Initialize Chart
    const ctx = document.getElementById('spendingChart').getContext('2d');
    const labels = {{ summary.category_labels | tojson }};
    const values = {{ summary.category_values | tojson }};

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          label: 'Spending',
          data: values,
          backgroundColor: [
            '#bb86fc', '#03dac6', '#cf6679', '#ffb74d', '#4fc3f7', '#aed581'
          ],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: '#a0a0a0' }
          }
        }
      }
    });

    // Custom tab highlighting for Dashboard
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('dashboard-tab').classList.add('active');
    });

    function handleUserIconClick() {
      window.location.href = '{{ url_for("user.user_details") }}';
    }
  </script>
</body>
</html>