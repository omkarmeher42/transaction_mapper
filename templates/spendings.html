<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spendings - Transaction Mapper</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='notifications.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <nav>
    <!-- Mobile Hamburger Menu Toggle -->
    <button class="hamburger-menu" id="hamburger-toggle" aria-label="Toggle navigation menu">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Left Side: Tabs -->
    <div class="tabs" id="nav-tabs">
        <div class="tab" id="dashboard-tab" data-tab="dashboard">
          <a href="/dashboard">
            <i class="fas fa-home"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div class="tab" id="map-transaction-tab" data-tab="map-transaction">
          <a href="/map_transaction">
            <i class="fas fa-map"></i>
            <span>Map Transaction</span>
          </a>
        </div>
        <div class="tab" id="quick-map-tab" data-tab="quick-map">
          <a href="/quick_map">
            <i class="fas fa-bolt"></i>
            <span>Quick Map</span>
          </a>
        </div>
        <div class="tab" id="view-transactions-tab" data-tab="view-transactions">
          <a href="/view_transactions">
            <i class="fas fa-list"></i>
            <span>View Transactions</span>
          </a>
        </div>
        <div class="tab" id="budgets-tab" data-tab="budgets">
          <a href="/budgets">
            <i class="fas fa-wallet"></i>
            <span>Budgets</span>
          </a>
        </div>
        <div class="tab" id="recurring-tab" data-tab="recurring">
          <a href="/recurring">
            <i class="fas fa-redo"></i>
            <span>Recurring</span>
          </a>
        </div>
        <div class="tab" id="download-tab" data-tab="download">
          <a href="/download">
            <i class="fas fa-download"></i>
            <span>Download</span>
          </a>
        </div>
        <div class="tab" id="spendings-tab" data-tab="spendings">
          <a href="{{ url_for('transaction.spendings') }}">
            <i class="fas fa-dollar-sign"></i>
            <span>Spendings</span>
          </a>
        </div>
      </div>

    <!-- Right Side: Theme Toggle and User Icon -->
    <div class="user-actions">
      <!-- Theme Toggle -->
      <div class="theme-toggle">
        <input type="checkbox" id="theme-switch">
        <label for="theme-switch" class="toggle-slider"></label>
      </div>

      <!-- User Icon -->
      <div class="user-icon" onclick="handleUserIconClick();">
        <i class="fas fa-user"></i>
      </div>

      <!-- Logout Link -->
      <a href="#" id="logoutLink" class="logout-link">Logout</a>
    </div>
  </nav>

  <!-- Flash Messages Container -->
  {% include 'notifications.html' %}

  <!-- Main Content -->
  <main class="view-transactions-container">
    <h1>Spendings Analysis</h1>

    <div class="left-side-container">
      <div class="month-year-container">
        <form method="POST" action="{{ url_for('transaction.spendings') }}" id="view-form">
          <div class="form-row">
            <div class="form-group">
              <label for="month">Month</label>
              <select id="month" name="month">
                <option value="" disabled>Select Month</option>
                {% for month_name in ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"] %}
                  <option value="{{ month_name }}" {% if request.form.get('month') == month_name %}selected{% endif %}>{{ month_name }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="form-group">
              <label for="year">Year</label>
              <select id="year" name="year">
                <option value="" disabled>Select Year</option>
                {% for year in range(2025, 2031) %}
                  <option value="{{ year }}" {% if request.form.get('year') == year|string %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <button type="submit" class="btn-primary view-button">
            <i class="fa fa-eye" aria-hidden="true"></i>
            <span>View</span>
          </button>
        </form>
      </div>
    </div>

    <div class="view-container">
      {% if total_spendings is not none %}
      <div class="total-spendings-card">
        <h2>Total Spendings</h2>
        <p class="amount">₹{{ total_spendings }}</p>
      </div>
      {% endif %}
      
      <div class="spending-cards">
        {% for category, amount in spendings_data.items() %}
        <div class="spending-card">
          <h3>{{ category }}</h3>
          <p class="amount">₹{{ amount }}</p>
        </div>
        {% endfor %}
      </div>
    </div>
  </main>

  <script src="{{ url_for('static', filename='main.js') }}"></script>
  <script>
    // Custom tab highlighting for Spendings
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('spendings-tab').classList.add('active');
    });

    function handleUserIconClick() {
      window.location.href = '{{ url_for("user.user_details") }}';
    }
  </script>
</body>
</html>